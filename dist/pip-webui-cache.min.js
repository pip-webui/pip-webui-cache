!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(n.pip||(n.pip={})).cache=e()}}(function(){var e;return function e(n,t,r){function o(u,a){if(!t[u]){if(!n[u]){var s="function"==typeof require&&require;if(!a&&s)return s(u,!0);if(i)return i(u,!0);var c=new Error("Cannot find module '"+u+"'");throw c.code="MODULE_NOT_FOUND",c}var l=t[u]={exports:{}};n[u][0].call(l.exports,function(e){var t=n[u][1][e];return o(t||e)},l,l.exports,e,n,t,r)}return t[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(n,t,r){(function(n){!function(n,o){"object"==typeof r&&void 0!==t?t.exports=o():"function"==typeof e&&e.amd?e(o):n.Dexie=o()}(this,function(){"use strict";function e(e,n){return"object"!=typeof n?e:(Ae(n).forEach(function(t){e[t]=n[t]}),e)}function t(e,n){return Ke.call(e,n)}function r(e,n){"function"==typeof n&&(n=n(Me(e))),Ae(n).forEach(function(t){o(e,t,n[t])})}function o(n,r,o,i){Ne(n,r,e(o&&t(o,"get")&&"function"==typeof o.get?{get:o.get,set:o.set,configurable:!0}:{value:o,configurable:!0,writable:!0},i))}function i(e){return{from:function(n){return e.prototype=Object.create(n.prototype),o(e.prototype,"constructor",e),{extend:r.bind(null,e.prototype)}}}}function u(e,n){var t,r=Re(e,n);return r||(t=Me(e))&&u(t,n)}function a(e,n,t){return Be.call(e,n,t)}function s(e,n){return n(e)}function c(e){if(!e)throw new Error("Assertion Failed")}function l(e){Te.setImmediate?setImmediate(e):setTimeout(e,0)}function f(e,n){return e.reduce(function(e,t,r){var o=n(t,r);return o&&(e[o[0]]=o[1]),e},{})}function h(e,n){return function(){try{e.apply(this,arguments)}catch(e){n(e)}}}function d(e,n,t){try{e.apply(null,t)}catch(e){n&&n(e)}}function p(e,n){if(t(e,n))return e[n];if(!n)return e;if("string"!=typeof n){for(var r=[],o=0,i=n.length;o<i;++o){var u=p(e,n[o]);r.push(u)}return r}var a=n.indexOf(".");if(-1!==a){var s=e[n.substr(0,a)];return void 0===s?void 0:p(s,n.substr(a+1))}}function v(e,n,t){if(e&&void 0!==n&&!("isFrozen"in Object&&Object.isFrozen(e)))if("string"!=typeof n&&"length"in n){c("string"!=typeof t&&"length"in t);for(var r=0,o=n.length;r<o;++r)v(e,n[r],t[r])}else{var i=n.indexOf(".");if(-1!==i){var u=n.substr(0,i),a=n.substr(i+1);if(""===a)void 0===t?delete e[u]:e[u]=t;else{var s=e[u];s||(s=e[u]={}),v(s,a,t)}}else void 0===t?delete e[n]:e[n]=t}}function g(e,n){"string"==typeof n?v(e,n,void 0):"length"in n&&[].map.call(n,function(n){v(e,n,void 0)})}function m(e){var n={};for(var r in e)t(e,r)&&(n[r]=e[r]);return n}function y(e){return Fe.apply([],e)}function b(e){if(!e||"object"!=typeof e)return e;var n;if(Se(e)){n=[];for(var r=0,o=e.length;r<o;++r)n.push(b(e[r]))}else if(Le.indexOf(e.constructor)>=0)n=e;else{n=e.constructor?Object.create(e.constructor.prototype):{};for(var i in e)t(e,i)&&(n[i]=b(e[i]))}return n}function w(e,n,r,o){return r=r||{},o=o||"",Ae(e).forEach(function(i){if(t(n,i)){var u=e[i],a=n[i];"object"==typeof u&&"object"==typeof a&&u&&a&&""+u.constructor==""+a.constructor?w(u,a,r,o+i+"."):u!==a&&(r[o+i]=n[i])}else r[o+i]=void 0}),Ae(n).forEach(function(i){t(e,i)||(r[o+i]=n[i])}),r}function _(e){var n,t,r,o;if(1===arguments.length){if(Se(e))return e.slice();if(this===Ve&&"string"==typeof e)return[e];if(o=Ue(e)){for(t=[];r=o.next(),!r.done;)t.push(r.value);return t}if(null==e)return[e];if("number"==typeof(n=e.length)){for(t=new Array(n);n--;)t[n]=e[n];return t}return[e]}for(n=arguments.length,t=new Array(n);n--;)t[n]=arguments[n];return t}function x(e,n){We=e,ze=n}function k(){if(Ge)try{throw k.arguments,new Error}catch(e){return e}return new Error}function P(e,n){var t=e.stack;return t?(n=n||0,0===t.indexOf(e.name)&&(n+=(e.name+e.message).split("\n").length),t.split("\n").slice(n).filter(ze).map(function(e){return"\n"+e}).join("")):""}function E(e,n){return function(){return console.warn(e+" is deprecated. See https://github.com/dfahlander/Dexie.js/wiki/Deprecations. "+P(k(),1)),n.apply(this,arguments)}}function O(e,n){this._e=k(),this.name=e,this.message=n}function j(e,n){return e+". Errors: "+n.map(function(e){return e.toString()}).filter(function(e,n,t){return t.indexOf(e)===n}).join("\n")}function D(e,n,t,r){this._e=k(),this.failures=n,this.failedKeys=r,this.successCount=t}function C(e,n){this._e=k(),this.name="BulkError",this.failures=n,this.message=j(e,n)}function I(e,n){if(!e||e instanceof O||e instanceof TypeError||e instanceof SyntaxError||!e.name||!en[e.name])return e;var t=new en[e.name](n||e.message,e);return"stack"in e&&o(t,"stack",{get:function(){return this.inner.stack}}),t}function A(){}function S(e){return e}function T(e,n){return null==e||e===S?n:function(t){return n(e(t))}}function M(e,n){return function(){e.apply(this,arguments),n.apply(this,arguments)}}function K(e,n){return e===A?n:function(){var t=e.apply(this,arguments);void 0!==t&&(arguments[0]=t);var r=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var i=n.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?M(r,this.onsuccess):r),o&&(this.onerror=this.onerror?M(o,this.onerror):o),void 0!==i?i:t}}function N(e,n){return e===A?n:function(){e.apply(this,arguments);var t=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,n.apply(this,arguments),t&&(this.onsuccess=this.onsuccess?M(t,this.onsuccess):t),r&&(this.onerror=this.onerror?M(r,this.onerror):r)}}function R(n,t){return n===A?t:function(r){var o=n.apply(this,arguments);e(r,o);var i=this.onsuccess,u=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?M(i,this.onsuccess):i),u&&(this.onerror=this.onerror?M(u,this.onerror):u),void 0===o?void 0===a?void 0:a:e(o,a)}}function B(e,n){return e===A?n:function(){return!1!==n.apply(this,arguments)&&e.apply(this,arguments)}}function F(e,n){return e===A?n:function(){var t=e.apply(this,arguments);if(t&&"function"==typeof t.then){for(var r=this,o=arguments.length,i=new Array(o);o--;)i[o]=arguments[o];return t.then(function(){return n.apply(r,i)})}return n.apply(this,arguments)}}function L(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=A,this._lib=!1;var n=this._PSD=Pn;if(We&&(this._stackHolder=k(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==tn)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&V(this,this._value))}this._state=null,this._value=null,++n.ref,U(this,e)}function q(e,n,t,r,o){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.resolve=t,this.reject=r,this.psd=o}function U(e,n){try{n(function(n){if(null===e._state){if(n===e)throw new TypeError("A promise cannot be resolved with itself.");var t=e._lib&&J();n&&"function"==typeof n.then?U(e,function(e,t){n instanceof L?n._then(e,t):n.then(e,t)}):(e._state=!0,e._value=n,W(e)),t&&Y()}},V.bind(null,e))}catch(n){V(e,n)}}function V(e,n){if(wn.push(n),null===e._state){var t=e._lib&&J();n=xn(n),e._state=!1,e._value=n,We&&null!==n&&"object"==typeof n&&!n._promise&&d(function(){var t=u(n,"stack");n._promise=e,o(n,"stack",{get:function(){return pn?t&&(t.get?t.get.apply(n):t.value):e.stack}})}),ee(e),W(e),t&&Y()}}function W(e){var n=e._listeners;e._listeners=[];for(var t=0,r=n.length;t<r;++t)z(e,n[t]);var o=e._PSD;--o.ref||o.finalize(),0===On&&(++On,gn(function(){0==--On&&X()},[]))}function z(e,n){if(null===e._state)return void e._listeners.push(n);var t=e._state?n.onFulfilled:n.onRejected;if(null===t)return(e._state?n.resolve:n.reject)(e._value);++n.psd.ref,++On,gn(G,[t,e,n])}function G(e,n,t){try{_n=n;var r,o=n._value;n._state?r=e(o):(wn.length&&(wn=[]),r=e(o),-1===wn.indexOf(o)&&ne(n)),t.resolve(r)}catch(e){t.reject(e)}finally{_n=null,0==--On&&X(),--t.psd.ref||t.psd.finalize()}}function Q(e,n,t){if(n.length===t)return n;var r="";if(!1===e._state){var o,i,u=e._value;null!=u?(o=u.name||"Error",i=u.message||u,r=P(u,0)):(o=u,i=""),n.push(o+(i?": "+i:"")+r)}return We&&(r=P(e._stackHolder,2),r&&-1===n.indexOf(r)&&n.push(r),e._prev&&Q(e._prev,n,t)),n}function $(e,n){var t=n?n._numPrev+1:0;t<rn&&(e._prev=n,e._numPrev=t)}function H(){J()&&Y()}function J(){var e=mn;return mn=!1,yn=!1,e}function Y(){var e,n,t;do{for(;En.length>0;)for(e=En,En=[],t=e.length,n=0;n<t;++n){var r=e[n];r[0].apply(null,r[1])}}while(En.length>0);mn=!0,yn=!0}function X(){var e=bn;bn=[],e.forEach(function(e){e._PSD.onunhandled.call(null,e._value,e)});for(var n=jn.slice(0),t=n.length;t;)n[--t]()}function Z(e){function n(){e(),jn.splice(jn.indexOf(n),1)}jn.push(n),++On,gn(function(){0==--On&&X()},[])}function ee(e){bn.some(function(n){return n._value===e._value})||bn.push(e)}function ne(e){for(var n=bn.length;n;)if(bn[--n]._value===e._value)return void bn.splice(n,1)}function te(e){return new L(tn,!1,e)}function re(e,n){var t=Pn;return function(){var r=J(),o=Pn;try{return le(t,!0),e.apply(this,arguments)}catch(e){n&&n(e)}finally{le(o,!1),r&&Y()}}}function oe(n,t,r,o){var i=Pn,u=Object.create(i);u.parent=i,u.ref=0,u.global=!1,u.id=++Kn;var a=kn.env;u.env=dn?{Promise:L,PromiseProp:{value:L,configurable:!0,writable:!0},all:L.all,race:L.race,resolve:L.resolve,reject:L.reject,nthen:ve(a.nthen,u),gthen:ve(a.gthen,u)}:{},t&&e(u,t),++i.ref,u.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=he(u,n,r,o);return 0===u.ref&&u.finalize(),s}function ie(){return In.id||(In.id=++An),++In.awaits,In.echoes+=on,In.id}function ue(e){!In.awaits||e&&e!==In.id||(0==--In.awaits&&(In.id=0),In.echoes=In.awaits*on)}function ae(e){return In.echoes&&e&&e.constructor===fn?(ie(),e.then(function(e){return ue(),e},function(e){return ue(),Rn(e)})):e}function se(e){++Mn,In.echoes&&0!=--In.echoes||(In.echoes=In.id=0),Sn.push(Pn),le(e,!0)}function ce(){var e=Sn[Sn.length-1];Sn.pop(),le(e,!1)}function le(e,n){var t=Pn;if((n?!In.echoes||Tn++&&e===Pn:!Tn||--Tn&&e===Pn)||de(n?se.bind(null,e):ce),e!==Pn&&(Pn=e,t===kn&&(kn.env=fe()),dn)){var r=kn.env.Promise,o=e.env;sn.then=o.nthen,r.prototype.then=o.gthen,(t.global||e.global)&&(Object.defineProperty(Te,"Promise",o.PromiseProp),r.all=o.all,r.race=o.race,r.resolve=o.resolve,r.reject=o.reject)}}function fe(){var e=Te.Promise;return dn?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(Te,"Promise"),all:e.all,race:e.race,resolve:e.resolve,reject:e.reject,nthen:sn.then,gthen:e.prototype.then}:{}}function he(e,n,t,r,o){var i=Pn;try{return le(e,!0),n(t,r,o)}finally{le(i,!1)}}function de(e){ln.call(an,e)}function pe(e,n,t){return"function"!=typeof e?e:function(){var r=Pn;t&&ie(),le(n,!0);try{return e.apply(this,arguments)}finally{le(r,!1)}}}function ve(e,n){return function(t,r){return e.call(this,pe(t,n,!1),pe(r,n,!1))}}function ge(n,t){var r;try{r=t.onuncatched(n)}catch(e){}if(!1!==r)try{var o,i={promise:t,reason:n};if(Te.document&&document.createEvent?(o=document.createEvent("Event"),o.initEvent(Nn,!0,!0),e(o,i)):Te.CustomEvent&&(o=new CustomEvent(Nn,{detail:i}),e(o,i)),o&&Te.dispatchEvent&&(dispatchEvent(o),!Te.PromiseRejectionEvent&&Te.onunhandledrejection))try{Te.onunhandledrejection(o)}catch(e){}o.defaultPrevented||console.warn("Unhandled rejection: "+(n.stack||n))}catch(e){}}function me(e){function n(e,n,i){if("object"==typeof e)return t(e);n||(n=B),i||(i=A);var u={subscribers:[],fire:i,subscribe:function(e){-1===u.subscribers.indexOf(e)&&(u.subscribers.push(e),u.fire=n(u.fire,e))},unsubscribe:function(e){u.subscribers=u.subscribers.filter(function(n){return n!==e}),u.fire=u.subscribers.reduce(n,i)}};return r[e]=o[e]=u,u}function t(e){Ae(e).forEach(function(t){var r=e[t];if(Se(r))n(t,e[t][0],e[t][1]);else{if("asap"!==r)throw new Ze.InvalidArgument("Invalid event config");var o=n(t,S,function(){for(var e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];o.subscribers.forEach(function(e){l(function(){e.apply(null,n)})})})}})}var r={},o=function(n,t){if(t){for(var o=arguments.length,i=new Array(o-1);--o;)i[o-1]=arguments[o];return r[n].subscribe.apply(null,i),e}if("string"==typeof n)return r[n]};o.addEventType=n;for(var i=1,u=arguments.length;i<u;++i)n(arguments[i]);return o}function ye(n,i){function u(e){this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null},this.stores({})}function l(e,n,t){var r=Xe._createTransaction(Ye,Ue,Le);r.create(n),r._completion.catch(t);var o=r._reject.bind(r);oe(function(){Pn.trans=r,0===e?(Ae(Le).forEach(function(e){P(n,e,Le[e].primKey,Le[e].indexes)}),L.follow(function(){return Xe.on.populate.fire(r)}).catch(o)):g(e,r,n).catch(o)})}function g(e,n,t){function r(){return o.length?L.resolve(o.shift()(n.idbtrans)).then(r):L.resolve()}var o=[],i=qe.filter(function(n){return n._cfg.version===e})[0];if(!i)throw new Ze.Upgrade("Dexie specification of currently installed DB version is missing");Le=Xe._dbSchema=i._cfg.dbschema;var u=!1;return qe.filter(function(n){return n._cfg.version>e}).forEach(function(e){o.push(function(){var r=Le,o=e._cfg.dbschema;de(r,t),de(o,t),Le=Xe._dbSchema=o;var i=x(r,o);if(i.add.forEach(function(e){P(t,e[0],e[1].primKey,e[1].indexes)}),i.change.forEach(function(e){if(e.recreate)throw new Ze.Upgrade("Not yet support for changing primary key");var n=t.objectStore(e.name);e.add.forEach(function(e){I(n,e)}),e.change.forEach(function(e){n.deleteIndex(e.name),I(n,e)}),e.del.forEach(function(e){n.deleteIndex(e)})}),e._cfg.contentUpgrade)return u=!0,L.follow(function(){e._cfg.contentUpgrade(n)})}),o.push(function(n){u&&Gn||j(e._cfg.dbschema,n)})}),r().then(function(){O(Le,t)})}function x(e,n){var t={del:[],add:[],change:[]};for(var r in e)n[r]||t.del.push(r);for(r in n){var o=e[r],i=n[r];if(o){var u={name:r,def:i,recreate:!1,del:[],add:[],change:[]};if(o.primKey.src!==i.primKey.src)u.recreate=!0,t.change.push(u);else{var a=o.idxByName,s=i.idxByName;for(var c in a)s[c]||u.del.push(c);for(c in s){var l=a[c],f=s[c];l?l.src!==f.src&&u.change.push(f):u.add.push(f)}(u.del.length>0||u.add.length>0||u.change.length>0)&&t.change.push(u)}}else t.add.push([r,i])}return t}function P(e,n,t,r){var o=e.db.createObjectStore(n,t.keyPath?{keyPath:t.keyPath,autoIncrement:t.auto}:{autoIncrement:t.auto});return r.forEach(function(e){I(o,e)}),o}function O(e,n){Ae(e).forEach(function(t){n.db.objectStoreNames.contains(t)||P(n,t,e[t].primKey,e[t].indexes)})}function j(e,n){for(var t=0;t<n.db.objectStoreNames.length;++t){var r=n.db.objectStoreNames[t];null==e[r]&&n.db.deleteObjectStore(r)}}function I(e,n){e.createIndex(n.name,n.keyPath,{unique:n.unique,multiEntry:n.multi})}function M(e,n,t){if(Je||Pn.letThrough){var r=Xe._createTransaction(e,n,Le);try{r.create()}catch(e){return Rn(e)}return r._promise(e,function(e,n){return oe(function(){return Pn.trans=r,t(e,n,r)})}).then(function(e){return r._completion.then(function(){return e})})}if(!$e){if(!Re)return Rn(new Ze.DatabaseClosed);Xe.open().catch(A)}return en.then(function(){return M(e,n,t)})}function B(e,n,t){var r=arguments.length;if(r<2)throw new Ze.InvalidArgument("Too few arguments");for(var o=new Array(r-1);--r;)o[r-1]=arguments[r];return t=o.pop(),[e,y(o),t]}function q(e,n,t){this.name=e,this.schema=n,this._tx=t,this.hook=ze[e]?ze[e].hook:me(null,{creating:[K,A],reading:[T,S],updating:[R,A],deleting:[N,A]})}function U(e,n,t){return(t?Pe:xe)(function(t){e.push(t),n&&n()})}function V(e,n,t,r,o){return new L(function(i,u){var a=t.length,s=a-1;if(0===a)return i();if(r){var c,l=Pe(u),f=_e(null);d(function(){for(var r=0;r<a;++r){c={onsuccess:null,onerror:null};var u=t[r];o.call(c,u[0],u[1],n);var h=e.delete(u[0]);h._hookCtx=c,h.onerror=l,h.onsuccess=r===s?_e(i):f}},function(e){throw c.onerror&&c.onerror(e),e})}else for(var h=0;h<a;++h){var p=e.delete(t[h]);p.onerror=xe(u),h===s&&(p.onsuccess=re(function(){return i()}))}})}function W(e,n,t,r){var o=this;this.db=Xe,this.mode=e,this.storeNames=n,this.idbtrans=null,this.on=me(this,"complete","error","abort"),this.parent=r||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new L(function(e,n){o._resolve=e,o._reject=n}),this._completion.then(function(){o.active=!1,o.on.complete.fire()},function(e){var n=o.active;return o.active=!1,o.on.error.fire(e),o.parent?o.parent._reject(e):n&&o.idbtrans&&o.idbtrans.abort(),Rn(e)})}function z(e,n,t){this._ctx={table:e,index:":id"===n?null:n,or:t}}function G(e,n){var t=null,r=null;if(n)try{t=n()}catch(e){r=e}var o=e._ctx,i=o.table;this._ctx={table:i,index:o.index,isPrimKey:!o.index||i.schema.primKey.keyPath&&o.index===i.schema.primKey.name,range:t,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:o.or,valueMapper:i.hook.reading.fire}}function Q(e,n){return!(e.filter||e.algorithm||e.or)&&(n?e.justLimit:!e.replayFilter)}function $(e,n){return e._cfg.version-n._cfg.version}function H(e,n,t){n.forEach(function(n){var r=t[n];e.forEach(function(e){n in e||(e===W.prototype||e instanceof W?o(e,n,{get:function(){return this.table(n)}}):e[n]=new q(n,r))})})}function J(e){e.forEach(function(e){for(var n in e)e[n]instanceof q&&delete e[n]})}function Y(e,n,t,r,o,i){var u=i?function(e,n,r){return t(i(e),n,r)}:t,a=re(u,o);e.onerror||(e.onerror=xe(o)),e.onsuccess=n?h(function(){var t=e.result;if(t){var i=function(){t.continue()};n(t,function(e){i=e},r,o)&&a(t.value,t,function(e){i=e}),i()}else r()},o):h(function(){var n=e.result;if(n){var t=function(){n.continue()};a(n.value,n,function(e){t=e}),t()}else r()},o)}function X(e){var n=[];return e.split(",").forEach(function(e){e=e.trim();var t=e.replace(/([&*]|\+\+)/g,""),r=/^\[/.test(t)?t.match(/^\[(.*)\]$/)[1].split("+"):t;n.push(new je(t,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),Se(r),/\./.test(e)))}),n}function Z(e,n){return Be.cmp(e,n)}function ee(e,n){return Z(e,n)<0?e:n}function ne(e,n){return Z(e,n)>0?e:n}function te(e,n){return Be.cmp(e,n)}function ae(e,n){return Be.cmp(n,e)}function se(e,n){return e<n?-1:e===n?0:1}function ce(e,n){return e>n?-1:e===n?0:1}function le(e,n){return e?n?function(){return e.apply(this,arguments)&&n.apply(this,arguments)}:e:n}function fe(){if(Xe.verno=Ge.version/10,Xe._dbSchema=Le={},Ue=a(Ge.objectStoreNames,0),0!==Ue.length){var e=Ge.transaction(Ce(Ue),"readonly");Ue.forEach(function(n){for(var t=e.objectStore(n),r=t.keyPath,o=r&&"string"==typeof r&&-1!==r.indexOf("."),i=new je(r,r||"",!1,!1,!!t.autoIncrement,r&&"string"!=typeof r,o),u=[],a=0;a<t.indexNames.length;++a){var s=t.index(t.indexNames[a]);r=s.keyPath,o=r&&"string"==typeof r&&-1!==r.indexOf(".");var c=new je(s.name,r,!!s.unique,!!s.multiEntry,!1,r&&"string"!=typeof r,o);u.push(c)}Le[n]=new De(n,i,u,{})}),H([ze],Ae(Le),Le)}}function de(e,n){for(var t=n.db.objectStoreNames,r=0;r<t.length;++r){var o=t[r],i=n.objectStore(o);be="getAll"in i;for(var u=0;u<i.indexNames.length;++u){var s=i.indexNames[u],c=i.index(s).keyPath,l="string"==typeof c?c:"["+a(c).join("+")+"]";if(e[o]){var f=e[o].idxByName[l];f&&(f.name=s)}}}/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Te.WorkerGlobalScope&&Te instanceof Te.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(be=!1)}function pe(e){Xe.on("blocked").fire(e),Wn.filter(function(e){return e.name===Xe.name&&e!==Xe&&!e._vcFired}).map(function(n){return n.on("versionchange").fire(e)})}var ve,ge,be,Me=ye.dependencies,Ke=e({addons:ye.addons,autoOpen:!0,indexedDB:Me.indexedDB,IDBKeyRange:Me.IDBKeyRange},i),Ne=Ke.addons,Re=Ke.autoOpen,Be=Ke.indexedDB,Fe=Ke.IDBKeyRange,Le=this._dbSchema={},qe=[],Ue=[],ze={},Ge=null,Qe=null,$e=!1,He=null,Je=!1,Ye="readwrite",Xe=this,en=new L(function(e){ve=e}),nn=new L(function(e,n){ge=n}),tn=!0,rn=!!Ie(Be);this.version=function(e){if(Ge||$e)throw new Ze.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var n=qe.filter(function(n){return n._cfg.version===e})[0];return n||(n=new u(e),qe.push(n),qe.sort($),tn=!1,n)},e(u.prototype,{stores:function(n){this._cfg.storesSource=this._cfg.storesSource?e(this._cfg.storesSource,n):n;var t={};qe.forEach(function(n){e(t,n._cfg.storesSource)});var r=this._cfg.dbschema={};return this._parseStoresSpec(t,r),Le=Xe._dbSchema=r,J([ze,Xe,W.prototype]),H([ze,Xe,W.prototype,this._cfg.tables],Ae(r),r),Ue=Ae(r),this},upgrade:function(e){return this._cfg.contentUpgrade=e,this},_parseStoresSpec:function(e,n){Ae(e).forEach(function(t){if(null!==e[t]){var r={},o=X(e[t]),i=o.shift();if(i.multi)throw new Ze.Schema("Primary key cannot be multi-valued");i.keyPath&&v(r,i.keyPath,i.auto?0:i.keyPath),o.forEach(function(e){if(e.auto)throw new Ze.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new Ze.Schema("Index must have a name and cannot be an empty string");v(r,e.keyPath,e.compound?e.keyPath.map(function(){return""}):"")}),n[t]=new De(t,i,o,r)}})}}),this._allTables=ze,this._createTransaction=function(e,n,t,r){return new W(e,n,t,r)},this._whenReady=function(e){return Je||Pn.letThrough?e():new L(function(e,n){if(!$e){if(!Re)return void n(new Ze.DatabaseClosed);Xe.open().catch(A)}en.then(e,n)}).then(e)},this.verno=0,this.open=function(){if($e||Ge)return en.then(function(){return Qe?Rn(Qe):Xe});We&&(nn._stackHolder=k()),$e=!0,Qe=null,Je=!1;var e=ve,t=null;return L.race([nn,new L(function(e,r){if(!Be)throw new Ze.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var o=tn?Be.open(n):Be.open(n,Math.round(10*Xe.verno));if(!o)throw new Ze.MissingAPI("IndexedDB API not available");o.onerror=xe(r),o.onblocked=re(pe),o.onupgradeneeded=re(function(e){if(t=o.transaction,tn&&!Xe._allowEmptyDB){o.onerror=Ee,t.abort(),o.result.close();var i=Be.deleteDatabase(n);i.onsuccess=i.onerror=re(function(){r(new Ze.NoSuchDatabase("Database "+n+" doesnt exist"))})}else{t.onerror=xe(r);l((e.oldVersion>Math.pow(2,62)?0:e.oldVersion)/10,t,r)}},r),o.onsuccess=re(function(){if(t=null,Ge=o.result,Wn.push(Xe),tn)fe();else if(Ge.objectStoreNames.length>0)try{de(Le,Ge.transaction(Ce(Ge.objectStoreNames),"readonly"))}catch(e){}Ge.onversionchange=re(function(e){Xe._vcFired=!0,Xe.on("versionchange").fire(e)}),rn||"__dbnames"===n||Cn.dbnames.put({name:n}).catch(A),e()},r)})]).then(function(){return He=[],L.resolve(ye.vip(Xe.on.ready.fire)).then(function e(){if(He.length>0){var n=He.reduce(F,A);return He=[],L.resolve(ye.vip(n)).then(e)}})}).finally(function(){He=null}).then(function(){return $e=!1,Xe}).catch(function(e){try{t&&t.abort()}catch(e){}return $e=!1,Xe.close(),Qe=e,Rn(Qe)}).finally(function(){Je=!0,e()})},this.close=function(){var e=Wn.indexOf(Xe);if(e>=0&&Wn.splice(e,1),Ge){try{Ge.close()}catch(e){}Ge=null}Re=!1,Qe=new Ze.DatabaseClosed,$e&&ge(Qe),en=new L(function(e){ve=e}),nn=new L(function(e,n){ge=n})},this.delete=function(){var e=arguments.length>0;return new L(function(t,r){function o(){Xe.close();var e=Be.deleteDatabase(n);e.onsuccess=re(function(){rn||Cn.dbnames.delete(n).catch(A),t()}),e.onerror=xe(r),e.onblocked=pe}if(e)throw new Ze.InvalidArgument("Arguments not allowed in db.delete()");$e?en.then(o):o()})},this.backendDB=function(){return Ge},this.isOpen=function(){return null!==Ge},this.hasBeenClosed=function(){return Qe&&Qe instanceof Ze.DatabaseClosed},this.hasFailed=function(){return null!==Qe},this.dynamicallyOpened=function(){return tn},this.name=n,r(this,{tables:{get:function(){return Ae(ze).map(function(e){return ze[e]})}}}),this.on=me(this,"populate","blocked","versionchange",{ready:[F,A]}),this.on.ready.subscribe=s(this.on.ready.subscribe,function(e){return function(n,t){ye.vip(function(){Je?(Qe||L.resolve().then(n),t&&e(n)):He?(He.push(n),t&&e(n)):(e(n),t||e(function e(){Xe.on.ready.unsubscribe(n),Xe.on.ready.unsubscribe(e)}))})}}),this.transaction=function(){var e=B.apply(this,arguments);return this._transaction.apply(this,e)},this._transaction=function(e,n,t){function r(){return L.resolve().then(function(){var n=Pn.transless||Pn,r=Xe._createTransaction(e,u,Le,o),i={trans:r,transless:n};o?r.idbtrans=o.idbtrans:r.create(),t.constructor===hn&&ie();var a,s=L.follow(function(){if(a=t.call(r,r))if(a.constructor===fn){var e=ue.bind(null,null);a.then(e,e)}else"function"==typeof a.next&&"function"==typeof a.throw&&(a=Oe(a))},i);return(a&&"function"==typeof a.then?L.resolve(a).then(function(e){return r.active?e:Rn(new Ze.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):s.then(function(){return a})).then(function(e){return o&&r._resolve(),r._completion.then(function(){return e})}).catch(function(e){return r._reject(e),Rn(e)})})}var o=Pn.trans;o&&o.db===Xe&&-1===e.indexOf("!")||(o=null);var i=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{var u=n.map(function(e){var n=e instanceof q?e.name:e;if("string"!=typeof n)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return n});if("r"==e||"readonly"==e)e="readonly";else{if("rw"!=e&&e!=Ye)throw new Ze.InvalidArgument("Invalid transaction mode: "+e);e=Ye}if(o){if("readonly"===o.mode&&e===Ye){if(!i)throw new Ze.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");o=null}o&&u.forEach(function(e){if(o&&-1===o.storeNames.indexOf(e)){if(!i)throw new Ze.SubTransaction("Table "+e+" not included in parent transaction.");o=null}}),i&&o&&!o.active&&(o=null)}}catch(e){return o?o._promise(null,function(n,t){t(e)}):Rn(e)}return o?o._promise(e,r,"lock"):Pn.trans?he(Pn.transless,function(){return Xe._whenReady(r)}):Xe._whenReady(r)},this.table=function(e){if(!t(ze,e))throw new Ze.InvalidTable("Table "+e+" does not exist");return ze[e]},r(q.prototype,{_trans:function(e,n,t){var r=this._tx||Pn.trans;return r&&r.db===Xe?r===Pn.trans?r._promise(e,n,t):oe(function(){return r._promise(e,n,t)},{trans:r,transless:Pn.transless||Pn}):M(e,[this.name],n)},_idbstore:function(e,n,t){function r(e,t,r){if(-1===r.storeNames.indexOf(o))throw new Ze.NotFound("Table"+o+" not part of transaction");return n(e,t,r.idbtrans.objectStore(o),r)}var o=this.name;return this._trans(e,r,t)},get:function(e,n){if(e&&e.constructor===Object)return this.where(e).first(n);var t=this;return this._idbstore("readonly",function(n,r,o){var i=o.get(e);i.onerror=xe(r),i.onsuccess=re(function(){n(t.hook.reading.fire(i.result))},r)}).then(n)},where:function(e){if("string"==typeof e)return new z(this,e);if(Se(e))return new z(this,"["+e.join("+")+"]");var n=Ae(e);if(1===n.length)return this.where(n[0]).equals(e[n[0]]);var t=this.schema.indexes.concat(this.schema.primKey).filter(function(e){return e.compound&&n.every(function(n){return e.keyPath.indexOf(n)>=0})&&e.keyPath.every(function(e){return n.indexOf(e)>=0})})[0];if(t&&Ln!==Fn)return this.where(t.name).equals(t.keyPath.map(function(n){return e[n]}));t||console.warn("The query "+JSON.stringify(e)+" on "+this.name+" would benefit of a compound index ["+n.join("+")+"]");var r=this.schema.idxByName,o=n.reduce(function(n,t){return[n[0]||r[t],n[0]||!r[t]?le(n[1],function(n){return""+p(n,t)==""+e[t]}):n[1]]},[null,null]),i=o[0];return i?this.where(i.name).equals(e[i.keyPath]).filter(o[1]):t?this.filter(o[1]):this.where(n).equals("")},count:function(e){return this.toCollection().count(e)},offset:function(e){return this.toCollection().offset(e)},limit:function(e){return this.toCollection().limit(e)},reverse:function(){return this.toCollection().reverse()},filter:function(e){return this.toCollection().and(e)},each:function(e){return this.toCollection().each(e)},toArray:function(e){return this.toCollection().toArray(e)},orderBy:function(e){return new G(new z(this,Se(e)?"["+e.join("+")+"]":e))},toCollection:function(){return new G(new z(this))},mapToClass:function(e,n){this.schema.mappedClass=e;var r=Object.create(e.prototype);n&&we(r,n),this.schema.instanceTemplate=r;var o=function(n){if(!n)return n;var r=Object.create(e.prototype);for(var o in n)if(t(n,o))try{r[o]=n[o]}catch(e){}return r};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=o,this.hook("reading",o),e},defineClass:function(e){return this.mapToClass(ye.defineClass(e),e)},bulkDelete:function(e){return this.hook.deleting.fire===A?this._idbstore(Ye,function(n,t,r,o){n(V(r,o,e,!1,A))}):this.where(":id").anyOf(e).delete().then(function(){})},bulkPut:function(e,n){var t=this;return this._idbstore(Ye,function(r,o,i){if(!i.keyPath&&!t.schema.primKey.auto&&!n)throw new Ze.InvalidArgument("bulkPut() with non-inbound keys requires keys array in second argument");if(i.keyPath&&n)throw new Ze.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(n&&n.length!==e.length)throw new Ze.InvalidArgument("Arguments objects and keys must have the same length");if(0===e.length)return r();var u,a,s=function(e){0===c.length?r(e):o(new C(t.name+".bulkPut(): "+c.length+" of "+l+" operations failed",c))},c=[],l=e.length,h=t;if(t.hook.creating.fire===A&&t.hook.updating.fire===A){a=U(c);for(var d=0,v=e.length;d<v;++d)u=n?i.put(e[d],n[d]):i.put(e[d]),u.onerror=a;u.onerror=U(c,s),u.onsuccess=ke(s)}else{var g=n||i.keyPath&&e.map(function(e){return p(e,i.keyPath)}),m=g&&f(g,function(n,t){return null!=n&&[n,e[t]]});(g?h.where(":id").anyOf(g.filter(function(e){return null!=e})).modify(function(){this.value=m[this.primKey],m[this.primKey]=null}).catch(D,function(e){c=e.failures}).then(function(){for(var t=[],r=n&&[],o=g.length-1;o>=0;--o){var i=g[o];(null==i||m[i])&&(t.push(e[o]),n&&r.push(i),null!=i&&(m[i]=null))}return t.reverse(),n&&r.reverse(),h.bulkAdd(t,r)}).then(function(e){var n=g[g.length-1];return null!=n?n:e}):h.bulkAdd(e)).then(s).catch(C,function(e){c=c.concat(e.failures),s()}).catch(o)}},"locked")},bulkAdd:function(e,n){var t=this,r=this.hook.creating.fire;return this._idbstore(Ye,function(o,i,u,a){function s(e){0===h.length?o(e):i(new C(t.name+".bulkAdd(): "+h.length+" of "+g+" operations failed",h))}if(!u.keyPath&&!t.schema.primKey.auto&&!n)throw new Ze.InvalidArgument("bulkAdd() with non-inbound keys requires keys array in second argument");if(u.keyPath&&n)throw new Ze.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(n&&n.length!==e.length)throw new Ze.InvalidArgument("Arguments objects and keys must have the same length");if(0===e.length)return o();var c,l,f,h=[],g=e.length;if(r!==A){var m,y=u.keyPath;l=U(h,null,!0),f=_e(null),d(function(){for(var t=0,o=e.length;t<o;++t){m={onerror:null,onsuccess:null};var i=n&&n[t],s=e[t],h=n?i:y?p(s,y):void 0,d=r.call(m,h,s,a);null==h&&null!=d&&(y?(s=b(s),v(s,y,d)):i=d),c=null!=i?u.add(s,i):u.add(s),c._hookCtx=m,t<o-1&&(c.onerror=l,m.onsuccess&&(c.onsuccess=f))}},function(e){throw m.onerror&&m.onerror(e),e}),c.onerror=U(h,s,!0),c.onsuccess=_e(s)}else{l=U(h);for(var w=0,_=e.length;w<_;++w)c=n?u.add(e[w],n[w]):u.add(e[w]),c.onerror=l;c.onerror=U(h,s),c.onsuccess=ke(s)}})},add:function(e,n){var t=this.hook.creating.fire;return this._idbstore(Ye,function(r,o,i,u){var a={onsuccess:null,onerror:null};if(t!==A){var s=null!=n?n:i.keyPath?p(e,i.keyPath):void 0,c=t.call(a,s,e,u);null==s&&null!=c&&(i.keyPath?v(e,i.keyPath,c):n=c)}try{var l=null!=n?i.add(e,n):i.add(e);l._hookCtx=a,l.onerror=Pe(o),l.onsuccess=_e(function(n){var t=i.keyPath;t&&v(e,t,n),r(n)})}catch(e){throw a.onerror&&a.onerror(e),e}})},put:function(e,n){var t=this,r=this.hook.creating.fire,o=this.hook.updating.fire;if(r!==A||o!==A){var i=this.schema.primKey.keyPath,u=void 0!==n?n:i&&p(e,i);return null==u?this.add(e):(e=b(e),this._trans(Ye,function(){return t.where(":id").equals(u).modify(function(){this.value=e}).then(function(r){return 0===r?t.add(e,n):u})},"locked"))}return this._idbstore(Ye,function(t,r,o){
var i=void 0!==n?o.put(e,n):o.put(e);i.onerror=xe(r),i.onsuccess=re(function(n){var r=o.keyPath;r&&v(e,r,n.target.result),t(i.result)})})},delete:function(e){return this.hook.deleting.subscribers.length?this.where(":id").equals(e).delete():this._idbstore(Ye,function(n,t,r){var o=r.delete(e);o.onerror=xe(t),o.onsuccess=re(function(){n(o.result)})})},clear:function(){return this.hook.deleting.subscribers.length?this.toCollection().delete():this._idbstore(Ye,function(e,n,t){var r=t.clear();r.onerror=xe(n),r.onsuccess=re(function(){e(r.result)})})},update:function(e,n){if("object"!=typeof n||Se(n))throw new Ze.InvalidArgument("Modifications must be an object.");if("object"!=typeof e||Se(e))return this.where(":id").equals(e).modify(n);Ae(n).forEach(function(t){v(e,t,n[t])});var t=p(e,this.schema.primKey.keyPath);return void 0===t?Rn(new Ze.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(t).modify(n)}}),r(W.prototype,{_lock:function(){return c(!Pn.global),++this._reculock,1!==this._reculock||Pn.global||(Pn.lockOwnerFor=this),this},_unlock:function(){if(c(!Pn.global),0==--this._reculock)for(Pn.global||(Pn.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{he(e[1],e[0])}catch(e){}}return this},_locked:function(){return this._reculock&&Pn.lockOwnerFor!==this},create:function(e){var n=this;if(!this.mode)return this;if(c(!this.idbtrans),!e&&!Ge)switch(Qe&&Qe.name){case"DatabaseClosedError":throw new Ze.DatabaseClosed(Qe);case"MissingAPIError":throw new Ze.MissingAPI(Qe.message,Qe);default:throw new Ze.OpenFailed(Qe)}if(!this.active)throw new Ze.TransactionInactive;return c(null===this._completion._state),e=this.idbtrans=e||Ge.transaction(Ce(this.storeNames),this.mode),e.onerror=re(function(t){Ee(t),n._reject(e.error)}),e.onabort=re(function(t){Ee(t),n.active&&n._reject(new Ze.Abort(e.error)),n.active=!1,n.on("abort").fire(t)}),e.oncomplete=re(function(){n.active=!1,n._resolve()}),this},_promise:function(e,n,t){var r=this;if(e===Ye&&this.mode!==Ye)return Rn(new Ze.ReadOnly("Transaction is readonly"));if(!this.active)return Rn(new Ze.TransactionInactive);if(this._locked())return new L(function(o,i){r._blockedFuncs.push([function(){r._promise(e,n,t).then(o,i)},Pn])});if(t)return oe(function(){var e=new L(function(e,t){r._lock();var o=n(e,t,r);o&&o.then&&o.then(e,t)});return e.finally(function(){return r._unlock()}),e._lib=!0,e});var o=new L(function(e,t){var o=n(e,t,r);o&&o.then&&o.then(e,t)});return o._lib=!0,o},_root:function(){return this.parent?this.parent._root():this},waitFor:function(e){var n=this._root();if(e=L.resolve(e),n._waitingFor)n._waitingFor=n._waitingFor.then(function(){return e});else{n._waitingFor=e,n._waitingQueue=[];var t=n.idbtrans.objectStore(n.storeNames[0]);!function e(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(t.get(-1/0).onsuccess=e)}()}var r=n._waitingFor;return new L(function(t,o){e.then(function(e){return n._waitingQueue.push(re(t.bind(null,e)))},function(e){return n._waitingQueue.push(re(o.bind(null,e)))}).finally(function(){n._waitingFor===r&&(n._waitingFor=null)})})},abort:function(){this.active&&this._reject(new Ze.Abort),this.active=!1},tables:{get:E("Transaction.tables",function(){return ze})},table:function(e){return new q(e,Xe.table(e).schema,this)}}),r(z.prototype,function(){function e(e,n,t){var r=e instanceof z?new G(e):e;return r._ctx.error=t?new t(n):new TypeError(n),r}function n(e){return new G(e,function(){return Fe.only("")}).limit(0)}function t(e){return"next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function r(e){return"next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function o(e,n,t,r,o,i){for(var u=Math.min(e.length,r.length),a=-1,s=0;s<u;++s){var c=n[s];if(c!==r[s])return o(e[s],t[s])<0?e.substr(0,s)+t[s]+t.substr(s+1):o(e[s],r[s])<0?e.substr(0,s)+r[s]+t.substr(s+1):a>=0?e.substr(0,a)+n[a]+t.substr(a+1):null;o(e[s],c)<0&&(a=s)}return u<r.length&&"next"===i?e+t.substr(e.length):u<e.length&&"prev"===i?e.substr(0,t.length):a<0?null:e.substr(0,a)+r[a]+t.substr(a+1)}function i(n,i,u,a){function s(e){c=t(e),l=r(e),f="next"===e?se:ce;var n=u.map(function(e){return{lower:l(e),upper:c(e)}}).sort(function(e,n){return f(e.lower,n.lower)});h=n.map(function(e){return e.upper}),d=n.map(function(e){return e.lower}),p=e,v="next"===e?"":a}var c,l,f,h,d,p,v,g=u.length;if(!u.every(function(e){return"string"==typeof e}))return e(n,Vn);s("next");var m=new G(n,function(){return Fe.bound(h[0],d[g-1]+a)});m._ondirectionchange=function(e){s(e)};var y=0;return m._addAlgorithm(function(e,n,t){var r=e.key;if("string"!=typeof r)return!1;var u=l(r);if(i(u,d,y))return!0;for(var a=null,s=y;s<g;++s){var c=o(r,u,h[s],d[s],f,p);null===c&&null===a?y=s+1:(null===a||f(a,c)>0)&&(a=c)}return n(null!==a?function(){e.continue(a+v)}:t),!1}),m}return{between:function(t,r,o,i){o=!1!==o,i=!0===i;try{return Z(t,r)>0||0===Z(t,r)&&(o||i)&&(!o||!i)?n(this):new G(this,function(){return Fe.bound(t,r,!o,!i)})}catch(n){return e(this,Un)}},equals:function(e){return new G(this,function(){return Fe.only(e)})},above:function(e){return new G(this,function(){return Fe.lowerBound(e,!0)})},aboveOrEqual:function(e){return new G(this,function(){return Fe.lowerBound(e)})},below:function(e){return new G(this,function(){return Fe.upperBound(e,!0)})},belowOrEqual:function(e){return new G(this,function(){return Fe.upperBound(e)})},startsWith:function(n){return"string"!=typeof n?e(this,Vn):this.between(n,n+Fn,!0,!0)},startsWithIgnoreCase:function(e){return""===e?this.startsWith(e):i(this,function(e,n){return 0===e.indexOf(n[0])},[e],Fn)},equalsIgnoreCase:function(e){return i(this,function(e,n){return e===n[0]},[e],"")},anyOfIgnoreCase:function(){var e=_.apply(Ve,arguments);return 0===e.length?n(this):i(this,function(e,n){return-1!==n.indexOf(e)},e,"")},startsWithAnyOfIgnoreCase:function(){var e=_.apply(Ve,arguments);return 0===e.length?n(this):i(this,function(e,n){return n.some(function(n){return 0===e.indexOf(n)})},e,Fn)},anyOf:function(){var t=_.apply(Ve,arguments),r=te;try{t.sort(r)}catch(n){return e(this,Un)}if(0===t.length)return n(this);var o=new G(this,function(){return Fe.bound(t[0],t[t.length-1])});o._ondirectionchange=function(e){r="next"===e?te:ae,t.sort(r)};var i=0;return o._addAlgorithm(function(e,n,o){for(var u=e.key;r(u,t[i])>0;)if(++i===t.length)return n(o),!1;return 0===r(u,t[i])||(n(function(){e.continue(t[i])}),!1)}),o},notEqual:function(e){return this.inAnyRange([[qn,e],[e,Ln]],{includeLowers:!1,includeUppers:!1})},noneOf:function(){var n=_.apply(Ve,arguments);if(0===n.length)return new G(this);try{n.sort(te)}catch(n){return e(this,Un)}var t=n.reduce(function(e,n){return e?e.concat([[e[e.length-1][1],n]]):[[qn,n]]},null);return t.push([n[n.length-1],Ln]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},inAnyRange:function(t,r){function o(e,n){for(var t=0,r=e.length;t<r;++t){var o=e[t];if(Z(n[0],o[1])<0&&Z(n[1],o[0])>0){o[0]=ee(o[0],n[0]),o[1]=ne(o[1],n[1]);break}}return t===r&&e.push(n),e}function i(e,n){return l(e[0],n[0])}function u(e){return!h(e)&&!d(e)}if(0===t.length)return n(this);if(!t.every(function(e){return void 0!==e[0]&&void 0!==e[1]&&te(e[0],e[1])<=0}))return e(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Ze.InvalidArgument);var a,s=!r||!1!==r.includeLowers,c=r&&!0===r.includeUppers,l=te;try{a=t.reduce(o,[]),a.sort(i)}catch(n){return e(this,Un)}var f=0,h=c?function(e){return te(e,a[f][1])>0}:function(e){return te(e,a[f][1])>=0},d=s?function(e){return ae(e,a[f][0])>0}:function(e){return ae(e,a[f][0])>=0},p=h,v=new G(this,function(){return Fe.bound(a[0][0],a[a.length-1][1],!s,!c)});return v._ondirectionchange=function(e){"next"===e?(p=h,l=te):(p=d,l=ae),a.sort(i)},v._addAlgorithm(function(e,n,t){for(var r=e.key;p(r);)if(++f===a.length)return n(t),!1;return!!u(r)||0!==Z(r,a[f][1])&&0!==Z(r,a[f][0])&&(n(function(){l===te?e.continue(a[f][0]):e.continue(a[f][1])}),!1)}),v},startsWithAnyOf:function(){var t=_.apply(Ve,arguments);return t.every(function(e){return"string"==typeof e})?0===t.length?n(this):this.inAnyRange(t.map(function(e){return[e,e+Fn]})):e(this,"startsWithAnyOf() only works with strings")}}}),r(G.prototype,function(){function n(e,n){e.filter=le(e.filter,n)}function r(e,n,t){var r=e.replayFilter;e.replayFilter=r?function(){return le(r(),n())}:n,e.justLimit=t&&!r}function o(e,n){e.isMatch=le(e.isMatch,n)}function i(e,n){if(e.isPrimKey)return n;var t=e.table.schema.idxByName[e.index];if(!t)throw new Ze.Schema("KeyPath "+e.index+" on object store "+n.name+" is not indexed");return n.index(t.name)}function u(e,n){var t=i(e,n);return e.keysOnly&&"openKeyCursor"in t?t.openKeyCursor(e.range||null,e.dir+e.unique):t.openCursor(e.range||null,e.dir+e.unique)}function a(e,n,r,o,i){var a=e.replayFilter?le(e.filter,e.replayFilter()):e.filter;e.or?function(){function s(){2==++f&&r()}function c(e,r,i){if(!a||a(r,i,s,o)){var u=r.primaryKey,c=""+u;"[object ArrayBuffer]"===c&&(c=""+new Uint8Array(u)),t(l,c)||(l[c]=!0,n(e,r,i))}}var l={},f=0;e.or._iterate(c,s,o,i),Y(u(e,i),e.algorithm,c,s,o,!e.keysOnly&&e.valueMapper)}():Y(u(e,i),le(e.algorithm,a),n,r,o,!e.keysOnly&&e.valueMapper)}return{_read:function(e,n){var t=this._ctx;return t.error?t.table._trans(null,Rn.bind(null,t.error)):t.table._idbstore("readonly",e).then(n)},_write:function(e){var n=this._ctx;return n.error?n.table._trans(null,Rn.bind(null,n.error)):n.table._idbstore(Ye,e,"locked")},_addAlgorithm:function(e){var n=this._ctx;n.algorithm=le(n.algorithm,e)},_iterate:function(e,n,t,r){return a(this._ctx,e,n,t,r)},clone:function(n){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return n&&e(r,n),t._ctx=r,t},raw:function(){return this._ctx.valueMapper=null,this},each:function(e){var n=this._ctx;return this._read(function(t,r,o){a(n,e,t,r,o)})},count:function(e){var n=this._ctx;if(Q(n,!0))return this._read(function(e,t,r){var o=i(n,r),u=n.range?o.count(n.range):o.count();u.onerror=xe(t),u.onsuccess=function(t){e(Math.min(t.target.result,n.limit))}},e);var t=0;return this._read(function(e,r,o){a(n,function(){return++t,!1},function(){e(t)},r,o)},e)},sortBy:function(e,n){function t(e,n){return n?t(e[o[n]],n-1):e[i]}function r(e,n){var r=t(e,u),o=t(n,u);return r<o?-a:r>o?a:0}var o=e.split(".").reverse(),i=o[0],u=o.length-1,a="next"===this._ctx.dir?1:-1;return this.toArray(function(e){return e.sort(r)}).then(n)},toArray:function(e){var n=this._ctx;return this._read(function(e,t,r){if(be&&"next"===n.dir&&Q(n,!0)&&n.limit>0){var o=n.table.hook.reading.fire,u=i(n,r),s=n.limit<1/0?u.getAll(n.range,n.limit):u.getAll(n.range);s.onerror=xe(t),s.onsuccess=ke(o===S?e:function(n){try{e(n.map(o))}catch(e){t(e)}})}else{var c=[];a(n,function(e){c.push(e)},function(){e(c)},t,r)}},e)},offset:function(e){var n=this._ctx;return e<=0?this:(n.offset+=e,Q(n)?r(n,function(){var n=e;return function(e,t){return 0===n||(1===n?(--n,!1):(t(function(){e.advance(n),n=0}),!1))}}):r(n,function(){var n=e;return function(){return--n<0}}),this)},limit:function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),r(this._ctx,function(){var n=e;return function(e,t,r){return--n<=0&&t(r),n>=0}},!0),this},until:function(e,t){return n(this._ctx,function(n,r,o){return!e(n.value)||(r(o),t)}),this},first:function(e){return this.limit(1).toArray(function(e){return e[0]}).then(e)},last:function(e){return this.reverse().first(e)},filter:function(e){return n(this._ctx,function(n){return e(n.value)}),o(this._ctx,e),this},and:function(e){return this.filter(e)},or:function(e){return new z(this._ctx.table,e,this)},reverse:function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(n,t){e(t.key,t)})},eachUniqueKey:function(e){return this._ctx.unique="unique",this.eachKey(e)},eachPrimaryKey:function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(n,t){e(t.primaryKey,t)})},keys:function(e){var n=this._ctx;n.keysOnly=!n.isMatch;var t=[];return this.each(function(e,n){t.push(n.key)}).then(function(){return t}).then(e)},primaryKeys:function(e){var n=this._ctx;if(be&&"next"===n.dir&&Q(n,!0)&&n.limit>0)return this._read(function(e,t,r){var o=i(n,r),u=n.limit<1/0?o.getAllKeys(n.range,n.limit):o.getAllKeys(n.range);u.onerror=xe(t),u.onsuccess=ke(e)}).then(e);n.keysOnly=!n.isMatch;var t=[];return this.each(function(e,n){t.push(n.primaryKey)}).then(function(){return t}).then(e)},uniqueKeys:function(e){return this._ctx.unique="unique",this.keys(e)},firstKey:function(e){return this.limit(1).keys(function(e){return e[0]}).then(e)},lastKey:function(e){return this.reverse().firstKey(e)},distinct:function(){var e=this._ctx,r=e.index&&e.table.schema.idxByName[e.index];if(!r||!r.multi)return this;var o={};return n(this._ctx,function(e){var n=e.primaryKey.toString(),r=t(o,n);return o[n]=!0,!r}),this},modify:function(n){var r=this,o=this._ctx,i=o.table.hook,u=i.updating.fire,a=i.deleting.fire;return this._write(function(o,i,s,c){function l(e,n){function r(e){return O.push(e),j.push(o.primKey),h(),!0}C=n.primaryKey;var o={primKey:n.primaryKey,value:e,onsuccess:null,onerror:null};if(!1!==g.call(o,e,o)){var i=!t(o,"value");++k,d(function(){var e=i?n.delete():n.update(o.value);e._hookCtx=o,e.onerror=Pe(r),e.onsuccess=_e(function(){++P,h()})},r)}else o.onsuccess&&o.onsuccess(o.value)}function f(e){return e&&(O.push(e),j.push(C)),i(new D("Error modifying one or more objects",O,P,j))}function h(){E&&P+O.length===k&&(O.length>0?f():o(P))}var g;if("function"==typeof n)g=u===A&&a===A?n:function(e){var r=b(e);if(!1===n.call(this,e,this))return!1;if(t(this,"value")){var o=w(r,this.value),i=u.call(this,o,this.primKey,r,c);i&&(e=this.value,Ae(i).forEach(function(n){v(e,n,i[n])}))}else a.call(this,this.primKey,e,c)};else if(u===A){var y=Ae(n),_=y.length;g=function(e){for(var t=!1,r=0;r<_;++r){var o=y[r],i=n[o];p(e,o)!==i&&(v(e,o,i),t=!0)}return t}}else{var x=n;n=m(x),g=function(t){var r=!1,o=u.call(this,n,this.primKey,b(t),c);return o&&e(n,o),Ae(n).forEach(function(e){var o=n[e];p(t,e)!==o&&(v(t,e,o),r=!0)}),o&&(n=m(x)),r}}var k=0,P=0,E=!1,O=[],j=[],C=null;r.clone().raw()._iterate(l,function(){E=!0,h()},f,s)})},delete:function(){var e=this,n=this._ctx,t=n.range,r=n.table.hook.deleting.fire,o=r!==A;if(!o&&Q(n)&&(n.isPrimKey&&!Qn||!t))return this._write(function(e,n,r){var o=xe(n),i=t?r.count(t):r.count();i.onerror=o,i.onsuccess=function(){var u=i.result;d(function(){var n=t?r.delete(t):r.clear();n.onerror=o,n.onsuccess=function(){return e(u)}},function(e){return n(e)})}});var i=o?2e3:1e4;return this._write(function(t,u,a,s){var c=0,l=e.clone({keysOnly:!n.isMatch&&!o}).distinct().limit(i).raw(),f=[],h=function(){return l.each(o?function(e,n){f.push([n.primaryKey,n.value])}:function(e,n){f.push(n.primaryKey)}).then(function(){return o?f.sort(function(e,n){return te(e[0],n[0])}):f.sort(te),V(a,s,f,o,r)}).then(function(){var e=f.length;return c+=e,f=[],e<i?c:h()})};t(h())})}}}),e(this,{Collection:G,Table:q,Transaction:W,Version:u,WhereClause:z}),function(){Xe.on("versionchange",function(e){e.newVersion>0?console.warn("Another connection wants to upgrade database '"+Xe.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+Xe.name+"'. Closing db now to resume the delete request."),Xe.close()}),Xe.on("blocked",function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('"+Xe.name+"') was blocked"):console.warn("Upgrade '"+Xe.name+"' blocked by other connection holding version "+e.oldVersion/10)})}(),Ne.forEach(function(e){e(Xe)})}function be(e){if("function"==typeof e)return new e;if(Se(e))return[be(e[0])];if(e&&"object"==typeof e){var n={};return we(n,e),n}return e}function we(e,n){return Ae(n).forEach(function(t){var r=be(n[t]);e[t]=r}),e}function _e(e){return re(function(n){var t=n.target,r=t._hookCtx,o=r.value||t.result,i=r&&r.onsuccess;i&&i(o),e&&e(o)},e)}function xe(e){return re(function(n){return Ee(n),e(n.target.error),!1})}function ke(e){return re(function(n){e(n.target.result)})}function Pe(e){return re(function(n){var t=n.target,r=t.error,o=t._hookCtx,i=o&&o.onerror;return i&&i(r),Ee(n),e(r),!1})}function Ee(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}function Oe(e){function n(e){return function(n){var t=e(n),r=t.value;return t.done?r:r&&"function"==typeof r.then?r.then(o,i):Se(r)?L.all(r).then(o,i):o(r)}}var t=function(n){return e.next(n)},r=function(n){return e.throw(n)},o=n(t),i=n(r);return n(t)()}function je(e,n,t,r,o,i,u){this.name=e,this.keyPath=n,this.unique=t,this.multi=r,this.auto=o,this.compound=i,this.dotted=u;var a="string"==typeof n?n:n&&"["+[].join.call(n,"+")+"]";this.src=(t?"&":"")+(r?"*":"")+(o?"++":"")+a}function De(e,n,t,r){this.name=e,this.primKey=n||new je,this.indexes=t||[new je],this.instanceTemplate=r,this.mappedClass=null,this.idxByName=f(t,function(e){return[e.name,e]})}function Ce(e){return 1===e.length?e[0]:e}function Ie(e){var n=e&&(e.getDatabaseNames||e.webkitGetDatabaseNames);return n&&n.bind(e)}var Ae=Object.keys,Se=Array.isArray,Te="undefined"!=typeof self?self:"undefined"!=typeof window?window:n,Me=Object.getPrototypeOf,Ke={}.hasOwnProperty,Ne=Object.defineProperty,Re=Object.getOwnPropertyDescriptor,Be=[].slice,Fe=[].concat,Le="Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set".split(",").concat(y([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(n){return n+e+"Array"})}))).filter(function(e){return Te[e]}).map(function(e){return Te[e]}),qe="undefined"!=typeof Symbol&&Symbol.iterator,Ue=qe?function(e){var n;return null!=e&&(n=e[qe])&&n.apply(e)}:function(){return null},Ve={},We="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href),ze=function(){return!0},Ge=!new Error("").stack,Qe=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],$e=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],He=Qe.concat($e),Je={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};i(O).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+P(this._e,2))}},toString:function(){return this.name+": "+this.message}}),i(D).from(O),i(C).from(O);var Ye=He.reduce(function(e,n){return e[n]=n+"Error",e},{}),Xe=O,Ze=He.reduce(function(e,n){function t(e,t){this._e=k(),this.name=r,e?"string"==typeof e?(this.message=e,this.inner=t||null):"object"==typeof e&&(this.message=e.name+" "+e.message,this.inner=e):(this.message=Je[n]||r,this.inner=null)}var r=n+"Error";return i(t).from(Xe),e[n]=t,e},{});Ze.Syntax=SyntaxError,Ze.Type=TypeError,Ze.Range=RangeError;var en=$e.reduce(function(e,n){return e[n+"Error"]=Ze[n],e},{}),nn=He.reduce(function(e,n){return-1===["Syntax","Type","Range"].indexOf(n)&&(e[n+"Error"]=Ze[n]),e},{});nn.ModifyError=D,nn.DexieError=O,nn.BulkError=C;var tn={},rn=100,on=7,un=function(){try{return new Function("let F=async ()=>{},p=F();return [p,Object.getPrototypeOf(p),Promise.resolve(),F.constructor];")()}catch(n){var e=Te.Promise;return e?[e.resolve(),e.prototype,e.resolve()]:[]}}(),an=un[0],sn=un[1],cn=un[2],ln=sn&&sn.then,fn=an&&an.constructor,hn=un[3],dn=!!cn,pn=!1,vn=cn?function(){cn.then(H)}:Te.setImmediate?setImmediate.bind(null,H):Te.MutationObserver?function(){var e=document.createElement("div");new MutationObserver(function(){H(),e=null}).observe(e,{attributes:!0}),e.setAttribute("i","1")}:function(){setTimeout(H,0)},gn=function(e,n){En.push([e,n]),yn&&(vn(),yn=!1)},mn=!0,yn=!0,bn=[],wn=[],_n=null,xn=S,kn={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ge,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(e){try{ge(e[0],e[1])}catch(e){}})}},Pn=kn,En=[],On=0,jn=[],Dn={get:function(){function e(e,r){var o=this,i=!n.global&&(n!==Pn||t!==Mn);i&&ue();var u=new L(function(t,u){z(o,new q(pe(e,n,i),pe(r,n,i),t,u,n))});return We&&$(u,this),u}var n=Pn,t=Mn;return e.prototype=tn,e},set:function(e){o(this,"then",e&&e.prototype===tn?Dn:{get:function(){return e},set:Dn.set})}};r(L.prototype,{then:Dn,_then:function(e,n){z(this,new q(null,null,e,n,Pn))},catch:function(e){if(1===arguments.length)return this.then(null,e);var n=arguments[0],t=arguments[1];return"function"==typeof n?this.then(null,function(e){return e instanceof n?t(e):te(e)}):this.then(null,function(e){return e&&e.name===n?t(e):te(e)})},finally:function(e){return this.then(function(n){return e(),n},function(n){return e(),te(n)})},stack:{get:function(){if(this._stack)return this._stack;try{pn=!0;var e=Q(this,[],20),n=e.join("\nFrom previous: ");return null!==this._state&&(this._stack=n),n}finally{pn=!1}}},timeout:function(e,n){var t=this;return e<1/0?new L(function(r,o){var i=setTimeout(function(){return o(new Ze.Timeout(n))},e);t.then(r,o).finally(clearTimeout.bind(null,i))}):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&o(L.prototype,Symbol.toStringTag,"Promise"),kn.env=fe(),r(L,{all:function(){var e=_.apply(null,arguments).map(ae);return new L(function(n,t){0===e.length&&n([]);var r=e.length;e.forEach(function(o,i){return L.resolve(o).then(function(t){e[i]=t,--r||n(e)},t)})})},resolve:function(e){if(e instanceof L)return e;if(e&&"function"==typeof e.then)return new L(function(n,t){e.then(n,t)});var n=new L(tn,!0,e);return $(n,_n),n},reject:te,race:function(){var e=_.apply(null,arguments).map(ae);return new L(function(n,t){e.map(function(e){return L.resolve(e).then(n,t)})})},PSD:{get:function(){return Pn},set:function(e){return Pn=e}},newPSD:oe,usePSD:he,scheduler:{get:function(){return gn},set:function(e){gn=e}},rejectionMapper:{get:function(){return xn},set:function(e){xn=e}},follow:function(e,n){return new L(function(t,r){return oe(function(n,t){var r=Pn;r.unhandleds=[],r.onunhandled=t,r.finalize=M(function(){var e=this;Z(function(){0===e.unhandleds.length?n():t(e.unhandleds[0])})},r.finalize),e()},n,t,r)})}});var Cn,In={awaits:0,echoes:0,id:0},An=0,Sn=[],Tn=0,Mn=0,Kn=0,Nn="unhandledrejection",Rn=L.reject,Bn="2.0.4",Fn=String.fromCharCode(65535),Ln=function(){try{return IDBKeyRange.only([[]]),[[]]}catch(e){return Fn}}(),qn=-1/0,Un="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Vn="String expected.",Wn=[],zn="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Gn=zn,Qn=zn,$n=function(e){return!/(dexie\.js|dexie\.min\.js)/.test(e)};return x(We,$n),r(ye,nn),r(ye,{delete:function(e){var n=new ye(e),t=n.delete();return t.onblocked=function(e){return n.on("blocked",e),this},t},exists:function(e){return new ye(e).open().then(function(e){return e.close(),!0}).catch(ye.NoSuchDatabaseError,function(){return!1})},getDatabaseNames:function(e){var n=Ie(ye.dependencies.indexedDB);return n?new L(function(e,t){var r=n();r.onsuccess=function(n){e(a(n.target.result,0))},r.onerror=xe(t)}).then(e):Cn.dbnames.toCollection().primaryKeys(e)},defineClass:function(){function n(n){n&&e(this,n)}return n},applyStructure:we,ignoreTransaction:function(e){return Pn.trans?he(Pn.transless,e):e()},vip:function(e){return oe(function(){return Pn.letThrough=!0,e()})},async:function(e){return function(){try{var n=Oe(e.apply(this,arguments));return n&&"function"==typeof n.then?n:L.resolve(n)}catch(e){return Rn(e)}}},spawn:function(e,n,t){try{var r=Oe(e.apply(t,n||[]));return r&&"function"==typeof r.then?r:L.resolve(r)}catch(e){return Rn(e)}},currentTransaction:{get:function(){return Pn.trans||null}},waitFor:function(e,n){var t=L.resolve("function"==typeof e?ye.ignoreTransaction(e):e).timeout(n||6e4);return Pn.trans?Pn.trans.waitFor(t):t},Promise:L,debug:{get:function(){return We},set:function(e){x(e,"dexie"===e?function(){return!0}:$n)}},derive:i,extend:e,props:r,override:s,Events:me,getByKeyPath:p,setByKeyPath:v,delByKeyPath:g,shallowClone:m,deepClone:b,getObjectDiff:w,asap:l,maxKey:Ln,minKey:qn,addons:[],connections:Wn,MultiModifyError:Ze.Modify,errnames:Ye,IndexSpec:je,TableSchema:De,dependencies:function(){try{return{indexedDB:Te.indexedDB||Te.mozIndexedDB||Te.webkitIndexedDB||Te.msIndexedDB,IDBKeyRange:Te.IDBKeyRange||Te.webkitIDBKeyRange}}catch(e){return{indexedDB:null,IDBKeyRange:null}}}(),semVer:Bn,version:Bn.split(".").map(function(e){return parseInt(e)}).reduce(function(e,n,t){return e+n/Math.pow(10,2*t)}),default:ye,Dexie:ye}),L.rejectionMapper=I,Cn=new ye("__dbnames"),Cn.version(1).stores({dbnames:"name"}),function(){try{void 0!==typeof localStorage&&void 0!==Te.document&&(JSON.parse(localStorage.getItem("Dexie.DatabaseNames")||"[]").forEach(function(e){return Cn.dbnames.put({name:e}).catch(A)}),localStorage.removeItem("Dexie.DatabaseNames"))}catch(e){}}(),ye})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,n,t){this.enableLogs=e,this.models=n,this.prefix=t}return e}();t.CacheConfigService=r;var o=function(){function e(){"ngInject";this.enableLogs=!1,this.models=[],this.prefix="PipCache"}return e.prototype.$get=function(){"ngInject";return null==this._service&&(this._service=new r(this.enableLogs,this.models,this.prefix)),this._service},e}();angular.module("pipCache").provider("pipCacheConfig",o)},{}],3:[function(e,n,t){"use strict";function r(e){"ngInject";e.interceptors.push(["$q","pipCache",function(e,n){var t=function(e){var n={};return e&&(e.hasOwnProperty("offset")&&(n.offset=parseInt(e.offset,10)),e.hasOwnProperty("limit")&&(n.limit=parseInt(e.limit,10))),n};return{request:function(r){for(var o=0,i=n.models;o<i.length;o++){var u=i[o],a=function(o){for(var i=0,u=Object.keys(o.interceptors);i<u.length;i++){var a=u[i],s=function(i){var u=o.interceptors[i],a=u.match.exec(r.url);if(a)switch(r.method){case"GET":switch(i){case"item":var s=a.groups;return{value:n.getItem(o.name,u.getKey(s),u.options).then(function(t){return t?(r.timeout=e.defer().promise,e.reject({cachedData:t})):(r.onResponse=function(e){n.setItem(o.name,e,u.options)},r)})};case"collection":var c=u.getParams?u.getParams(r.params):t(r.params);return{value:n.getItems(o.name,c,u.options).then(function(t){if(t){r.timeout=e.defer().promise;var i=u.responseModify?u.responseModify.itemsToResponse(t):t;return e.reject({cachedData:i})}return r.onResponse=function(e){var t=u.responseModify?u.responseModify.responseToItems(e):e;n.setItems(o.name,t,{params:c,options:u.options})},r})};default:console.error("Unknown type of interceptor ("+i+")")}case"POST":case"PUT":switch(i){case"item":case"collection":r.onResponse=function(e){n.setItem(o.name,e,{removeTotal:"POST"===r.method})}}case"DELETE":switch(i){case"item":var l=a.groups;r.onResponse=function(e){n.deleteItems(o.name,[u.getKey(l)])}}}}(a);if("object"==typeof s)return s}}(u);if("object"==typeof a)return a.value}return r},response:function(e){return e.config.hasOwnProperty("onResponse")&&"function"==typeof e.config.onResponse&&e.config.onResponse(e.data),e},responseError:function(n){return n&&n.cachedData?e.resolve({data:n.cachedData}):e.reject(n)}}}])}r.$inject=["$httpProvider"],Object.defineProperty(t,"__esModule",{value:!0}),angular.module("pipCache").config(r)},{}],4:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e}();t.CacheCollectionParams=r;var o=function(){function e(){}return e}();t.CacheInterceptorOptions=o;var i=function(){function e(){}return e}();t.CacheModel=i},{}],5:[function(e,n,t){"use strict";var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))(function(o,i){function u(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(u,a)}s((r=r.apply(e,n||[])).next())})},o=this&&this.__generator||function(e,n){function t(e){return function(n){return r([e,n])}}function r(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(u=i[2&t[0]?"return":t[0]?"throw":"next"])&&!(u=u.call(i,t[1])).done)return u;switch(i=0,u&&(t=[0,u.value]),t[0]){case 0:case 1:u=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(u=a.trys,!(u=u.length>0&&u[u.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!u||t[1]>u[0]&&t[1]<u[3])){a.label=t[1];break}if(6===t[0]&&a.label<u[1]){a.label=u[1],u=t;break}if(u&&a.label<u[2]){a.label=u[2],a.ops.push(t);break}u[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(e,a)}catch(e){t=[6,e],i=0}finally{o=u=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}var o,i,u,a={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return{next:t(0),throw:t(1),return:t(2)}};Object.defineProperty(t,"__esModule",{value:!0});var i=e("dexie"),u=function(){function e(e){this.config=e,this.openedDbs=new Map}return e.prototype.getDbName=function(e){if(!e)throw new Error("Model name should be defined");return this.config.prefix+e.charAt(0).toUpperCase()+e.slice(1)},e.prototype.getDb=function(e){if(!e||!e.name)throw new Error("Model should be defined");var n=this.getDbName(e.name);if(this.openedDbs.has(n))return this.openedDbs.get(n);var t=new i.Dexie(n),r=e.options.key||"id";return t.version(1).stores({items:r,lastRead:"",indexes:"idx,"+r,meta:""}),this.openedDbs.set(n,t),t},e.prototype.getModel=function(e){return this.models.find(function(n){return n.name===e})},Object.defineProperty(e.prototype,"models",{get:function(){return this.config.models||[]},enumerable:!0,configurable:!0}),e.prototype.getItem=function(e,n,t){return r(this,void 0,void 0,function(){var r,i,u,a,s,c,l;return o(this,function(o){switch(o.label){case 0:return r=this.getModel(e),i=this.getDb(r),[4,Promise.all([i.table("lastRead").get(n),i.table("items").get(n)])];case 1:return u=o.sent(),a=u[0],s=u[1],c=t&&t.maxAge||r.options.maxAge,l=a+c<=(new Date).valueOf(),this.config.enableLogs&&(console.groupCollapsed("[PipCache] GET single item #"+n),console.log("Item: ",s),console.log("Expired: ",l),console.log("Expired at: ",new Date(a)),console.groupEnd()),[2,l?null:s]}})})},e.prototype.getItems=function(e,n,t){return r(this,void 0,void 0,function(){var r,i,u,a,s,c,l,f,h,d,p,v,g,h,d,m,v,g,y,v,g;return o(this,function(o){switch(o.label){case 0:return r=this.getModel(e),i=this.getDb(r),u=r.options.key||"id",[4,i.table("meta").get("total")];case 1:return a=o.sent(),(s=t&&t.maxAge||r.options.maxAge,c=a&&a.lastRead+s>=(new Date).valueOf()?a.total:void 0,this.config.enableLogs&&(console.groupCollapsed("[PipCache] GET collection of items"),console.log("Params: ",n)),n&&Object.keys(n).length)?(l=n.hasOwnProperty("offset")?n.offset:0,f=n.hasOwnProperty("limit")?n.limit:void 0,void 0===f?[3,6]:[4,i.table("indexes").where("idx").between(l,l+f,!0,!1).toArray()]):[3,10];case 2:return h=o.sent(),h.length===f||void 0!==c&&h.length===c-l?[3,3]:(this.config.enableLogs&&(console.log("There's not enough information about indexes"),console.groupEnd()),[2,null]);case 3:return d=h.map(function(e){return e.id}),[4,Promise.all([i.table("items").where(u).anyOf(d).toArray(),i.table("lastRead").where("").anyOf(d).toArray()])];case 4:return p=o.sent(),(v=p[0],
g=p[1],v&&v.length===h.length&&g&&g.length===h.length)?Math.min.apply(Math,g)+s<=(new Date).valueOf()?(this.config.enableLogs&&(console.log("Items was expired"),console.groupEnd()),[2,null]):(this.config.enableLogs&&(console.log("Items: ",v),console.groupEnd()),[2,v]):(this.config.enableLogs&&(console.warn("Not all items presented in cache"),console.groupEnd()),[2,null]);case 5:return[3,9];case 6:return void 0===c?[3,9]:[4,i.table("indexes").where("idx").aboveOrEqual(l).toArray()];case 7:return h=o.sent(),h.length!==f||h.length!==c-l?(this.config.enableLogs&&(console.log("Not all items presented in cache"),console.groupEnd()),[2,null]):(d=h.map(function(e){return e.id}),[4,Promise.all([i.table("items").where(u).anyOf(d).toArray(),i.table("lastRead").where(u).anyOf(d).toArray()])]);case 8:return m=o.sent(),(v=m[0],g=m[1],v&&v.length===h.length&&g&&g.length===h.length)?Math.min.apply(Math,g)+s>=(new Date).valueOf()?(this.config.enableLogs&&(console.log("Items was expired"),console.groupEnd()),[2,null]):(this.config.enableLogs&&(console.log("Items: ",v),console.groupEnd()),[2,v]):(this.config.enableLogs&&(console.log("Not all items presented in cache"),console.groupEnd()),[2,null]);case 9:return[3,13];case 10:return void 0===c?[3,12]:[4,Promise.all([i.table("items").toArray(),i.table("lastRead").toArray()])];case 11:return y=o.sent(),(v=y[0],g=y[1],v&&v.length===c&&g&&g.length===c)?Math.min.apply(Math,g)+s<=(new Date).valueOf()?(this.config.enableLogs&&(console.log("Items was expired"),console.groupEnd()),[2,null]):(this.config.enableLogs&&(console.log("Items: ",v),console.groupEnd()),[2,v]):(this.config.enableLogs&&(console.log("Not all items presented in cache"),console.groupEnd()),[2,null]);case 12:return this.config.enableLogs&&(console.log("We want to return all items, but we don't know how many they are"),console.groupEnd()),[2,null];case 13:return[2]}})})},e.prototype.setItem=function(e,n,t){return r(this,void 0,void 0,function(){var r,i,u,a,s;return o(this,function(o){switch(o.label){case 0:return r=this.getModel(e),i=this.getDb(r),[4,Promise.all([i.table("lastRead").put((new Date).valueOf(),n[r.options.key]),i.table("items").put(n)])];case 1:return u=o.sent(),a=u[0],s=u[1],t&&t.removeTotal?[4,i.table("meta").delete("total")]:[3,3];case 2:o.sent(),o.label=3;case 3:return this.config.enableLogs&&(console.groupCollapsed("[PipCache] SET single item #"+n[r.options.key]),console.log("Item: ",s),console.log("Readed at: ",new Date),console.groupEnd()),[2,s]}})})},e.prototype.setItems=function(e,n,t){return r(this,void 0,void 0,function(){var r,i,u,a,s,c,l,f,h,d=this;return o(this,function(o){return r=this.getModel(e),i=r.options.key||"id",u=this.getDb(r),a=(new Date).valueOf(),s=t&&t.params&&t.params.offset||0,c=n.map(function(e){return e[i]}),l=c.map(function(e,n){return{id:e,idx:n+s}}),f=[u.table("lastRead").bulkPut(new Array(n.length).fill(a),c),u.table("items").bulkPut(n),u.table("indexes").bulkPut(l)],!(t&&t.params&&t.params.limit&&n&&n.length<t.params.limit)&&t&&t.params&&Object.keys(t.params).length||(h=(t.params.offset||0)+n.length,f.push(u.table("meta").put({lastRead:(new Date).valueOf(),total:h},"total"))),[2,Promise.all(f).then(function(e){var r=e[0];return d.config.enableLogs&&(console.groupCollapsed("[PipCache] SET collection of items"),console.log("Params: ",t.params),console.log("Items: ",n),console.log("Last read at: ",new Date),r&&2===r.length&&console.log("New total: ",h),console.groupEnd()),n})]})})},e.prototype.deleteItems=function(e,n){return r(this,void 0,void 0,function(){var t,r,i,u=this;return o(this,function(o){return t=this.getModel(e),r=this.getDb(t),i=t.options.key||"id",[2,Promise.all([r.table("lastRead").bulkDelete(n),r.table("items").bulkDelete(n),r.table("indexes").where(i).anyOf(n).delete(),r.table("meta").delete("total")]).then(function(){u.config.enableLogs&&(console.groupCollapsed("[PipCache] DELETE"),console.log("Keys: ",n),console.groupEnd())})]})})},e.prototype.clear=function(e){return r(this,void 0,void 0,function(){var n=this;return o(this,function(t){return[2,new Promise(function(t){var r=[];e?(Array.isArray(e)?r.push.apply(r,e.map(function(e){return n.getDbName(e)})):r.push(n.getDbName(e)),t(r)):t(i.Dexie.getDatabaseNames())}).then(function(e){var t=e.filter(function(e){return e.startsWith(n.config.prefix)});n.config.enableLogs&&console.log("databases to delete: ",e);for(var r=[],o=0,u=t;o<u.length;o++){var a=u[o];try{var s=n.openedDbs.has(a)?n.openedDbs.get(a):new i.Dexie(a);r.push(s.table("items").clear()),r.push(s.table("meta").clear()),r.push(s.table("lastRead").clear()),r.push(s.table("indexes").clear())}catch(e){n.config.enableLogs&&console.warn("Error opening database "+a)}}return Promise.all(r)}).then(function(t){return n.config.enableLogs&&(console.log("%c%s","color: blue; font: 1.2rem Impact;","[PipCache] CLEAR"),e?console.log("Model(s): ",e):console.log("all models")),null})]})})},e}();t.CacheService=u;var a=function(){function e(e){"ngInject";this.pipCacheConfigProvider=e}return e.$inject=["pipCacheConfigProvider"],Object.defineProperty(e.prototype,"models",{get:function(){return this.pipCacheConfigProvider.models},enumerable:!0,configurable:!0}),e.prototype.registerModel=function(e){return!!e&&(!this.models.find(function(n){return n.name===e.name})&&(this.models.push(e),!0))},e.prototype.$get=function(){"ngInject";return null==this._service&&(this._service=new u(this.pipCacheConfigProvider)),this._service},e}();angular.module("pipCache").provider("pipCache",a)},{dexie:1}],6:[function(e,n,t){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),angular.module("pipCache",[]),e("./cache-config.service"),e("./cache.service"),e("./cache.interceptor"),r(e("./cache.models")),r(e("./cache-config.service")),r(e("./cache.service"))},{"./cache-config.service":2,"./cache.interceptor":3,"./cache.models":4,"./cache.service":5}],7:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),e("./cache/index"),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(e("./cache/index"))},{"./cache/index":6}]},{},[7])(7)});
//# sourceMappingURL=pip-webui-cache.min.js.map
